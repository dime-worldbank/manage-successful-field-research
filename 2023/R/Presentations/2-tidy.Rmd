---
title: "Session 2 - Tidy data management"
subtitle: "R labs - Manage Successful Field Research"
author: "Galileu Kim, Luis Eduardo San Martin"
date: "The World Bank | [WB Github](https://github.com/worldbank) <br> May 2023"
output:
  xaringan::moon_reader:
    css: ["libs/remark-css/default.css", "libs/remark-css/metropolis.css", "libs/remark-css/metropolis-fonts.css", "libs/remark-css/custom.css"]
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
# Load packages
library(knitr)
library(xaringanExtra)
library(here)
here::i_am("Presentations/1-intro.Rmd")
options(htmltools.dir.version = FALSE)
opts_chunk$set(
  fig.align = "center",
  fig.height = 4,
  dpi = 300,
  cache = T
  )
xaringanExtra::use_panelset()
xaringanExtra::use_webcam()
xaringanExtra::use_clipboard()
htmltools::tagList(
  xaringanExtra::use_clipboard(
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
xaringanExtra::use_logo(
  image_url = here("Presentations",
                   "img",
                   "lightbulb.png"),
  exclude_class = c("inverse", 
                    "hide_logo"),
  width = "40px"
)
```

```{css, echo = F, eval = T}
@media print {
  .has-continuation {
    display: block !important;
  }
}
```

# Table of contents

1. [About the session](#about-this-session)

---

class: inverse, center, middle
name: about-this-session

# About this session

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

# About this session

.pull-left[
```{r echo = FALSE, out.width="99%"}
knitr::include_graphics("img/session2/intro2.png")
```
]
.pull-right[
We'll also cover one piping, part of the basics of R that we couldn't do in the first session.
]

---

# About this session

## Questions we will answer today

1. What is the ideal format to handle data in statistical programming?

1. How can I get data into this format?

1. Why is this format ideal?

---

class: inverse, center, middle
name: about-this-session

# Piping

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

---

class: inverse, center, middle
name: about-this-session

# Data formats

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

# Data formats

- Data can be acquired in multiple formats, bit in development research it is most commonly acquired as one or more **data tables**

<font size="7"><b>Data table:</b> A format where data is organized into rows and columns</font>

- It's also called *tabular data* or *rectangular data*

---

# Data formats

```{r echo = FALSE, out.width="90%"}
knitr::include_graphics("img/session2/tabular-data.png")
```

---

# Data formats

## Non-tabular data

.pull-left[

- Some examples of non-tabular data are images, text, and geospatial data

- Everything we cover today doesn't apply to these other formats

]
.pull-right[
```{r echo = FALSE, out.width="70%"}
knitr::include_graphics("img/session2/non-tabular-data.png")
```
]

---

# Data formats

## Tabular data

.pull-left[
- Data tables can be organized in multiple ways

- Not all of them result in easy to handle datasets
]
.pull-right[

```{r echo = FALSE, out.width="70%"}
knitr::include_graphics("img/session2/long-data.png")
```

<p style="text-align: center;">Example: Data stacked by rows</p>
]

---

# Data formats

## Tabular data

- Data tables can be organized in multiple ways

- Not all of them result in easy to handle datasets

```{r echo = FALSE, out.width="60%"}
knitr::include_graphics("img/session2/wide-data.png")
```

<p style="text-align: center;">Example: Data spread over columns</p>

---

# Data formats

## Tabular data

.pull-left[
- Fortunately, a vast literature of database management has identified the format that makes interacting with the data as easy as it can be

- In database management this is called **normalization**

- When applied to statistics, we call data in this ideal format **tidy**
]
.pull-right[
```{r echo = FALSE, out.width="95%"}
knitr::include_graphics("img/session2/tidydata.png")
```
]

---

class: inverse, center, middle
name: about-this-session

# Tidy data

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

# Tidy data

- A data table is **tidy** when:

.exercise[

1. Each column corresponds to **one variable**

2. Each row corresponds to **one observation**

3. All variables in the data table have the **same unit** of observation

]

- Every other format is untidy

- Data you might obtain from field work or a government counterpart is rarely tidy

---

# Tidy data

## Some definitions

In some statistical software, columns are usually called *variables* and rows are called *observations*. However, these are not necessarily the same. From now on:

- A **variable** is a collection of values that measure the same attribute across different units

- An **observation** is a collection of all values measured on the same unit across attributes

- A **data point** represents one variable for one observation. Data points are also called *values*

- A **dataset** is a collection of data points

---

# Tidy data

## Definitions in practice

.pull-left[
- What are the relevant data points here?

- What are the attributes measured in this table?

- At what level are these attributes observed?

- What is the unit of observation represented in this table?
]
.pull-right[
```{r echo = FALSE, out.width="80%"}
knitr::include_graphics("img/session2/long-data.png")
```
]

---

# Tidy data

## Is this dataset tidy?

.pull-left[
- <span style="color: Green;">All variables have the **same unit of observation** (country)</span>
]
.pull-right[
```{r echo = FALSE, out.width="80%"}
knitr::include_graphics("img/session2/long-data.png")
```
]

---

# Tidy data

## Is this dataset tidy?

.pull-left[
- <span style="color: green;">All variables have the **same unit of observation** (country)</span>

- <span style="color: red;">There are **multiple variables** represented in a **single column**</span>
]
.pull-right[
```{r echo = FALSE, out.width="80%"}
knitr::include_graphics("img/session2/long-data-value-highlight.png")
```
]

---

# Tidy data

## Is this dataset tidy?

.pull-left[
- <span style="color: green;">All variables have the **same unit of observation** (country)</span>

- <span style="color: red;">There are **multiple variables** represented in a **single column**</span>

- <span style="color: red;">Each observation is **separated into multiple rows**</span>
]
.pull-right[
```{r echo = FALSE, out.width="80%"}
knitr::include_graphics("img/session2/long-data-unit-highlight.png")
```
]

---

class: inverse, center, middle
name: about-this-session

# Tidying a dataset

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

# Tidying a dataset

## How would this table look in a tidy format?

```{r echo = FALSE, out.width="38%"}
knitr::include_graphics("img/session2/long-data.png")
```

---

# Tidying a dataset

## How would this table look in a tidy format?

```{r echo = FALSE, out.width="65%"}
knitr::include_graphics("img/session2/tidy-countries.png")
```

---

# Tidying a dataset

- When all variables in a data table have the same unit of observation,
**reshaping** is enough to make untidy data tidy

```{r echo = FALSE, out.width="85%"}
knitr::include_graphics("img/session2/reshape-long-to-wide.png")
```

---

# Tidying a dataset

- When all variables in a data table have the same unit of observation,
reshaping is enough to make untidy data tidy

```{r echo = FALSE, out.width="85%"}
knitr::include_graphics("img/session2/reshape-long-to-wide.png")
```

- Reshaping **does not change the content of the data points** in the table

---

# Tidying a dataset

- When all variables in a data table have the same unit of observation,
reshaping is enough to make untidy data tidy

.exercise[
<font size="6"><b>Reshaping:</b> A transformation of rows and columns in a data table that changes the unit of observation of the rows</font>
]

---

# Tidying a dataset

## `tidyr`

.pull-left[
- There are multiple options to reshape in R. We'll use the package `tidyr`

- `tidyr` is part of the suite of packages included in the tidyverse. You don't have to install it if you installed the tidyverse

- `tidyr` allows us to use functions to reshape R dataframes
]
.pull-right[
```{r echo = FALSE, out.width="60%"}
knitr::include_graphics("img/session2/tidyr.png")
```
]

---

# Tidying a dataset

## `tidyr`

- We'll use the function `pivot_wider()` from `tidyr`

- `pivot_wider()` takes the following arguments:

```{r eval=FALSE}
tidy_df <- pivot_wider(
  untidy_df,
  names_from = column_with_names,
  values_from = column_with_values
)
```

- the first argument is the input dataframe
  
- `names_from` is the column that contains the variables names
  
- `values_from` is the column that contains the data points

---

# Tidying a dataset

## `pivot_wider()`

- Using `pivot_wider()` requires inspecting your data to know which columns will be the used for the arguments `names_from` and `values_from`

---

# Tidying a dataset

## Exercise 2

- Load the file XXX from 

---

class: inverse, center, middle

# Thanks! // Â¡Gracias!

<html><div style='float:left'></div><hr color='#D38C28' size=1px width=1100px></html>

---

exclude: true

```{R, include = FALSE, eval = FALSE}
pagedown::chrome_print("2-tidy.html", output = "2-tidy.pdf")
```